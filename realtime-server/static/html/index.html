<!DOCTYPE html>
<html>
  <head>
    <title>socket.io chat</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  </head>
  <body>
    <h1>Redis Pubsub Socket IO!!</h1>
    <ul id="messages"></ul>
    <input id="input_msg" autocomplete="off" /><button id="send">Send</button>
    <button id="connect">Connect</button>
    <button id="disconnect">DisConnect</button>
    </form>
    <script>

      var socketio = { on: () => {}};
      // var socketio = io("http://localhost:7000");
      var realtimeServer = "http://localhost:7000";
      $(function() {
        const msgChannel = 'msg_channel';

        var num = 1;
        var channel;
        $('#connect').click(() => {
          console.log('clicked!!');
          // if (!socketio.connected) {
            socketio = io(realtimeServer, {
              query: { roomId: num }
            });
            socketio.on('connect', () => {
              channel = `${msgChannel}${num}`;

              console.log('msg --> ', channel);
              // socketio.emit(msgChannel, "Hello from Client^^");
            });

            socketio.on(channel, (msg) => {
              console.log("From RealTime: ", msg);
            });

            socketio.on('disconnect', () => {
              console.log('disconnected.');
            });
            num++;

          // } else {
          //   socketio.connect();
          // }
        });

        $('#send').click(() => {
            console.log('send clicked!! ----> ', $('#input_msg').val());
        //   socketio.on('message', function(msg) {
        //     $('#messages').append($('<li>').text('connecting: ' + msg));
        //   });
          socketio.emit('message', msgChannel, $('#input_msg').val());
          $('#input_msg').val('');
          return false;
        });

        $('#disconnect').click(() => {
          console.log('disconnect clicked!!');
          socketio.disconnect();
          return false;
        });

        socketio.on(msgChannel, function(msg) {
          console.log('channel response: ', msg)
        // socketio.on('message', function(msg) {
        //   socketio.emit('message', $('#input_msg').val());
          $('#messages').append($('<li>').text(msg));
          $('#input_msg').val('');
          return false;
        });
      });
    </script>
  </body>
</html>
